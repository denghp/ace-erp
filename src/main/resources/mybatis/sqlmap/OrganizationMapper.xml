<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.ace.erp.persistence.OrganizationMapper">

    <resultMap id="organizationMap" type="com.ace.erp.entity.sys.Organization">
        <result property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="tradeCodeId" column="trade_code_id"/>
        <result property="logo" column="logo"/>
        <result property="site" column="site"/>
        <result property="userCount" column="user_count" />
        <result property="address" column="address" />
        <result property="description" column="description"/>
        <result property="status" column="status" />
        <result property="createTime" column="create_time" javaType="java.lang.String"
                typeHandler="com.ace.erp.handler.mybatis.StringISODateTimeTypeHandler"/>
        <result property="expireTime" column="expire_time" javaType="java.lang.String"
                typeHandler="com.ace.erp.handler.mybatis.StringISODateTimeTypeHandler"/>
        <result property="modifyTime" column="modify_time" javaType="java.lang.String"
                typeHandler="com.ace.erp.handler.mybatis.StringISODateTimeTypeHandler"/>
    </resultMap>

    <resultMap type="Organization" id="userOrganizationMap" extends="organizationMap">
        <collection column="organization_id" property="userList" ofType="User"
                    resultMap="com.ace.erp.persistence.UserMapper.userResult" />
    </resultMap>

    <insert id="save" parameterType="User" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO
        sys_organization (name,trade_code_id,user_count,description,address,telephone,logo,site,status,expire_time,create_time,modify_time)
        VALUES
        (#{name},#{tradeCodeId},#{userCount},#{description},#{address},#{telephone},#{logo},#{site},#{status},
        <if test="expireTime == null">
            date_add(now(), interval 30 day),
        </if>
        <if test="expireTime != null">
            #{expireTime,typeHandler=com.ace.erp.handler.mybatis.StringISODateTimeTypeHandler},
        </if>
        <if test="createTime == null">
            now(),
        </if>
        <if test="createTime != null">
            #{createTime,typeHandler=com.ace.erp.handler.mybatis.StringISODateTimeTypeHandler},
        </if>
        <if test="modifyTime == null">
            now()
        </if>
        <if test="modifyTime != null">
            #{modifyTime,typeHandler=com.ace.erp.handler.mybatis.StringISODateTimeTypeHandler}
        </if>
        )
    </insert>

    <select id="getOne" parameterType="java.lang.Integer" resultMap="organizationMap">
    SELECT
      id,name,trade_code_id,user_count,logo,site,description,address,status,create_time,expire_time,modify_time,telephone
    FROM sys_organization  WHERE id = #{id}
  </select>

</mapper>