<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.ace.erp.shiro.persistence.UserMapper">

    <resultMap id="userResult" type="com.ace.erp.entity.sys.User">
        <result property="id" column="id"/>
        <result property="username" column="name"/>
        <result property="password" column="password"/>
        <result property="email" column="email"/>
        <result property="mobilePhoneNumber" column="mobile_phone_number"/>
        <result property="createTime" column="create_time" javaType="java.lang.String" typeHandler="com.ace.erp.handler.mybatis.StringISODateTimeTypeHandler"/>
        <result property="modifyTime" column="modify_time" javaType="java.lang.String" typeHandler="com.ace.erp.handler.mybatis.StringISODateTimeTypeHandler"/>
        <result property="salt" column="salt"/>
        <result property="status" column="status"/>
        <result property="admin" column="admin"/>
        <result property="deleted" column="deleted"/>
    </resultMap>

  <select id="getUserByName" parameterType="java.lang.String" resultMap="userResult">
    SELECT id,username,password,email,mobile_phone_number,salt,status,organization_id,organization_name,deleted,admin,create_time,modify_time FROM sys_user WHERE username = #{username}
  </select>

  <select id="getUserByEmail" parameterType="java.lang.String" resultMap="userResult">
    SELECT id,username,password,email,mobile_phone_number,salt,status,organization_id,organization_name,deleted,admin,create_time,modify_time  FROM sys_user WHERE email = #{email}
  </select>

   <select id="getAllUsers" resultMap="userResult">
    SELECT id,username,password,email,mobile_phone_number,salt,status,organization_id,organization_name,deleted,admin,create_time,modify_time  FROM sys_user limit 100;
  </select>

  <select id="getAllCount" resultType="int">
    SELECT count(*) FROM sys_user;
  </select>

    <select id="getUserById" parameterType="java.lang.Long" resultMap="userResult">
    SELECT id,username,password,email,mobile_phone_number,salt,status,organization_id,organization_name,deleted,admin,create_time,modify_time  FROM sys_user WHERE id = #{userId}
  </select>

  <select id="getByMobilePhoneNumber" parameterType="java.lang.String" resultMap="userResult">
    SELECT id,username,password,email,mobile_phone_number,salt,status,organization_id,organization_name,deleted,admin,create_time,modify_time FROM sys_user WHERE mobile_phone_number = #{mobilePhoneNumber}
  </select>

  <insert id="saveUser" parameterType="User" useGeneratedKeys="true" keyProperty="id">
      INSERT INTO
        sys_user (username,password,email,mobile_phone_number,salt,create_time,modify_time,status,deleted,admin)
      VALUES
        (#{username},#{password},#{email},#{mobilePhoneNumber},#{salt},
        <if test="createTime == null">
           now(),
        </if>
       <if test="createTime != null">
           #{createTime,typeHandler=com.ace.erp.handler.mybatis.StringISODateTimeTypeHandler},
       </if>
      <if test="modifyTime == null">
          now(),
      </if>
      <if test="modifyTime != null">
          #{modifyTime,typeHandler=com.ace.erp.handler.mybatis.StringISODateTimeTypeHandler},
      </if>
      #{status},#{deleted},#{admin})
  </insert>

  <update id="update" parameterType="User">
      update sys_user set
      <if test="username != null">
        username = #{username},
      </if>
      <if test="password != null">
        password = #{password},
      </if>
      <if test="email != null">
        email = #{email},
      </if>
      <if test="mobilePhoneNumber != null">
        mobile_phone_number = #{mobilePhoneNumber},
      </if>
      <if test="salt != null">
        salt = #{salt},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,typeHandler=com.ace.erp.handler.mybatis.StringISODateTimeTypeHandler},
      </if>
      <if test="status != null">
        status = #{status},
      </if>
      <if test="deleted != null">
        deleted = ${deleted},
      </if>
      <if test="admin != null">
        admin = ${admin},
      </if>
      modify_time = now()
      where id = #{id}
  </update>

  <update id="changePassword" parameterType="java.util.Map">
      update sys_user set password = #{password} where id = #{userId}
  </update>

    <delete id="delete" parameterType="java.lang.Long">
      delete from sys_user where id = #{userId}
  </delete>
</mapper>